<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Pagos - Citas Ya</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --container-w: 920px;
      --container-pad: 20px;
      --container-bl: 4px;

      --banner-h: 64px;
      --page-sidepad: 16px;
      --banner-bg: #e6e9ee;
      --banner-bg-hover: #d7dbe3;
    }

    body{
      font-family: 'Open Sans', sans-serif;
      background:#eeeeee;
      margin:0;
      padding:20px;
      color:#333;
      padding-top: calc(var(--banner-h) + 8px);
    }
    .container{
      max-width: var(--container-w);
      margin: 0 auto;
      padding: var(--container-pad);
      background:#fff;
      border-radius:10px;
      box-shadow:0 4px 8px rgba(0,0,0,.05);
      border-left: var(--container-bl) solid #5c6bc0;
    }
    h1{ text-align:center; margin:0 0 14px; font-weight:700; color:#000; }
    h2{ margin:20px 0 12px; font-weight:700; color:#000; }
    h3{ margin:12px 0 8px; color:#233247; }

    label{ display:block; margin:8px 0 4px; color:#003366; }
    input[type="text"], input[type="number"], select, textarea{
      width:100%; padding:10px; border:2px solid #ddd; border-radius:6px; font-size:16px;
      transition: border-color .2s; box-sizing:border-box;
    }
    textarea{ min-height:210px; resize:vertical; }

    .muted{ color:#666; font-size:14px; }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .row-3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }

    .packages{
      border:1px dashed #bdbdbd; border-radius:8px; padding:12px; background:#fafafa; margin:8px 0 12px;
    }
    .packages ul{ margin:6px 0 0 18px; }
    .price{ font-weight:700; }

    .btn{
      display:block; border:none; border-radius:6px; padding:12px 18px; color:#fff; font-weight:700; cursor:pointer;
      transition: background-color .2s, transform .2s; width:100%; margin:10px 0; font-size:16px;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn-green{ background:#66bb6a; } .btn-green:hover{ background:#43a047; }
    .btn-blue{ background:#5c6bc0; } .btn-blue:hover{ background:#3f51b5; }
    .btn-red{ background:#ef5350; } .btn-red:hover{ background:#e53935; }
    .btn-slim{ width:min(640px, 75%); margin:12px auto; }

    .radio-group{ display:flex; align-items:center; gap:10px; }

    /* ===== Banner ===== */
    .app-banner{ position:fixed; top:0; left:0; right:0; height:var(--banner-h); z-index:9999; background:transparent; }
    .app-banner .banner-box{
      height:100%;
      width:min(calc(var(--container-w) + var(--container-pad)*2 + var(--container-bl)), calc(100% - var(--page-sidepad)*2));
      margin:0 auto; background:var(--banner-bg); border-bottom:1px solid rgba(0,0,0,.06); border-radius:10px;
      display:flex; align-items:center; transition:background-color .2s ease;
    }
    .app-banner .banner-box:hover,.app-banner .banner-box:focus-within{ background:var(--banner-bg-hover); }
    .app-banner .banner-inner{ display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:8px; width:100%; padding:0 12px;}
    .banner-back{ justify-self:start; }
    .banner-title{ justify-self:center; font-weight:700; color:#233247; }
    .banner-logo{ justify-self:end; display:inline-flex; align-items:center; }
    .banner-logo img{ width:52px; height:auto; display:block; }
    .back-button{
      display:inline-block; text-decoration:none; font-size:14px; color:#5c6bc0;
      padding:8px 12px; border:1px solid #5c6bc0; border-radius:6px; transition: background-color .2s, color .2s;
    }
    .back-button:hover{ background:#5c6bc0; color:#fff; }

    /* Footer legal fuera del card */
    .legal-outside{
      margin: 18px auto 24px; padding:10px 12px;
      max-width: calc(var(--container-w) + var(--container-pad)*2 + var(--container-bl));
      text-align:center; color:#666; font-size:14px; line-height:1.35;
    }

    @media (max-width: 768px){
      .row, .row-3{ grid-template-columns: 1fr; }
      .btn-slim{ width:100%; }
    }
  </style>
</head>
<body>

  <!-- ===== Banner ===== -->
  <header class="app-banner" role="banner">
    <div class="banner-box">
      <div class="banner-inner">
        <a href="#" class="back-button banner-back" onclick="history.back(); return false;">&larr; Volver</a>
        <div class="banner-title">Pagos</div>
        <a href="interfaz_inicio_s.html" class="banner-logo" aria-label="Ir al inicio">
          <img src="LogoCitasYa.png" alt="Citas Ya">
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <h1>Comprar tokens</h1>

    <p class="muted">Cada <strong>30 min</strong> de cita consume <strong>1 token</strong>. Puedes escoger un paquete o indicar una cantidad manual.</p>

    <!-- Lista de paquetes (info) -->
    <div class="packages">
      <strong>Paquetes disponibles</strong>
      <ul>
        <li>50 tokens — <span class="price">$21.000</span> ( <em>$420/token</em> )</li>
        <li>100 tokens — <span class="price">$34.000</span> ( <em>$340/token</em> )</li>
        <li>150 tokens — <span class="price">$42.000</span> ( <em>$280/token</em> )</li>
        <li>200 tokens — <span class="price">$44.000</span> ( <em>$220/token</em> )</li>
      </ul>
      <p class="muted" style="margin:8px 0 0;">¿Más de 200 tokens? Te conviene <strong>Citas Ya Plus</strong> ($47.000/mes, tokens ilimitados).</p>
    </div>

    <!-- Selección -->
    <section>
      <h2>Selecciona tu compra</h2>
      <div class="row">
        <div>
          <label for="paquete">Paquete</label>
          <select id="paquete">
            <option value="">— Elegir paquete —</option>
            <option value="50">50 tokens — $21.000</option>
            <option value="100">100 tokens — $34.000</option>
            <option value="150">150 tokens — $42.000</option>
            <option value="200">200 tokens — $44.000</option>
          </select>
        </div>
        <div>
          <label for="tokens_manual">Cantidad manual (tokens)</label>
          <input type="number" id="tokens_manual" min="1" step="1" placeholder="Ej: 65" />
          <small class="muted">El precio por token usará la tarifa del paquete anterior (≤50: $420; 51–100: $340; 101–150: $280; 151–200: $220).</small>
        </div>
      </div>
    </section>

    <!-- Plus -->
    <section style="margin-top:8px;">
      <div class="radio-group">
        <input type="checkbox" id="plus" />
        <label for="plus"><strong>Citas Ya Plus</strong> (tokens ilimitados 1 mes) — <span class="price">$47.000</span></label>
      </div>
    </section>

    <!-- Método de pago -->
    <section style="margin-top:8px;">
      <label>Método de pago</label>
      <div class="radio-group">
        <input type="radio" name="metodo_pago" id="mp" value="Mercado Pago" checked />
        <label for="mp">Mercado Pago</label>
      </div>
    </section>

    <!-- Resumen -->
    <section>
      <h2>Resumen</h2>
      <div class="row-3">
        <div>
          <label for="resumen_tokens">Tokens</label>
          <input type="text" id="resumen_tokens" readonly />
        </div>
        <div>
          <label for="valor_pago">Valor a pagar (COP)</label>
          <input type="text" id="valor_pago" readonly />
        </div>
        <div>
          <label for="metodo">Método</label>
          <input type="text" id="metodo" value="Mercado Pago" readonly />
        </div>
      </div>
    </section>

    <button id="realizar_pago" class="btn btn-green btn-slim">Realizar pago</button>
  </div>

  <!-- Legal -->
  <div class="legal-outside">
    Todos los derechos reservados © 2025<br>
    Citas Ya S.A.S - Nit 810.000.000-0
  </div>

  <script>
    // --------- Configuración de precios/links ----------
    const PACKS = {
      "50":  { tokens: 50,  price: 21000, perToken: 420, link: "https://mpago.li/28hZUAL" },
      "100": { tokens: 100, price: 34000, perToken: 340, link: "https://mpago.li/2yEEqdM" },
      "150": { tokens: 150, price: 42000, perToken: 280, link: "https://mpago.li/1wcD9Gp" },
      "200": { tokens: 200, price: 44000, perToken: 220, link: "https://mpago.li/1S7Hwd5" }
    };
    const PLUS = { price: 47000, link: "https://mpago.li/1vd8RJo" };
    const GENERIC_LINK = "https://link.mercadopago.com.co/citasya";

    // Tarifas por tramo para cantidad manual
    function perTokenManual(q){
      if (q <= 50) return 420;
      if (q <= 100) return 340;
      if (q <= 150) return 280;
      if (q <= 200) return 220;
      return 220; // si alguien pone >200, de todos modos se recomendará Plus
    }

    const $ = sel => document.querySelector(sel);
    const paqueteSel = $("#paquete");
    const tokensManual = $("#tokens_manual");
    const plusChk = $("#plus");
    const resumenTokens = $("#resumen_tokens");
    const valorPago = $("#valor_pago");
    const metodo = $("#metodo");
    const btnPagar = $("#realizar_pago");

    function fmtCOP(n){
      return Number(n).toLocaleString("es-CO");
    }

    function clearOthers(except){
      if (except !== "pack") paqueteSel.value = "";
      if (except !== "manual") tokensManual.value = "";
      if (except !== "plus") plusChk.checked = false;
    }

    function updateSummaryFromPack(code){
      const p = PACKS[code];
      if(!p) return;
      resumenTokens.value = `${p.tokens} tokens`;
      valorPago.value = `$ ${fmtCOP(p.price)}`;
    }

    function updateSummaryFromManual(q){
      if(!q || q < 1){ resumenTokens.value = ""; valorPago.value = ""; return; }
      const unit = perTokenManual(q);
      const total = q * unit;
      resumenTokens.value = `${q} tokens ( $${fmtCOP(unit)}/token )`;
      valorPago.value = `$ ${fmtCOP(total)}`;
    }

    function updateSummaryFromPlus(){
      resumenTokens.value = `Citas Ya Plus (ilimitado 1 mes)`;
      valorPago.value = `$ ${fmtCOP(PLUS.price)}`;
    }

    paqueteSel.addEventListener("change", () => {
      if (paqueteSel.value){
        clearOthers("pack");
        updateSummaryFromPack(paqueteSel.value);
      } else {
        resumenTokens.value = "";
        valorPago.value = "";
      }
    });

    tokensManual.addEventListener("input", () => {
      const q = parseInt(tokensManual.value, 10);
      if (!isNaN(q) && q > 0){
        clearOthers("manual");
        updateSummaryFromManual(q);
      } else {
        resumenTokens.value = "";
        valorPago.value = "";
      }
    });

    plusChk.addEventListener("change", () => {
      if (plusChk.checked){
        clearOthers("plus");
        updateSummaryFromPlus();
      } else {
        resumenTokens.value = "";
        valorPago.value = "";
      }
    });

    btnPagar.addEventListener("click", (e) => {
      e.preventDefault();

      // Prioridad: Plus > Paquete > Manual
      if (plusChk.checked){
        window.location.href = PLUS.link;
        return;
      }

      if (paqueteSel.value && PACKS[paqueteSel.value]){
        window.location.href = PACKS[paqueteSel.value].link;
        return;
      }

      const q = parseInt(tokensManual.value, 10);
      if (!isNaN(q) && q > 0){
        // Manual siempre va al link genérico
        window.location.href = GENERIC_LINK;
        return;
      }

      alert("Selecciona un paquete, ingresa una cantidad de tokens o activa Citas Ya Plus.");
    });

    // Inicial
    metodo.value = "Mercado Pago";
  </script>
</body>
</html>
